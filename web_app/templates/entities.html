{% extends "base.html" %}
{% block content %}
<div class="container">
    <h1>Добавить компанию</h1>
    <button id="addEntityBtn" class="btn">Добавить компанию</button>

    <!-- Структура модального окна -->
    <div id="addEntityModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Добавить компанию</h2>
            <form id="addEntityForm" class="compact-form">
                <label for="entity_name">Название компании:</label>
                <input type="text" id="entity_name" name="entity_name" required><br>
                <button type="button" id="submitEntityBtn">Добавить компанию</button>
            </form>
        </div>
    </div>

    <h2>Список Компаний</h2>
    <table id="entities_table" border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Наименование компании</th>
            </tr>
        </thead>
        <tbody>
        {% for entity in entities %}
            <tr>
                <td>{{ entity.id }}</td>
                <td>{{ entity.name }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function() {
        $('#entities_table').DataTable();

        var modal = document.getElementById('addEntityModal');
        var btn = document.getElementById('addEntityBtn');
        var span = document.getElementsByClassName('close')[0];

        btn.onclick = function() {
            modal.style.display = 'block';
        }

        span.onclick = function() {
            modal.style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        $('#submitEntityBtn').click(function() {
            var formData = $('#addEntityForm').serialize();
            $.ajax({
                type: 'POST',
                url: '{{ url_for("add_entity") }}',
                data: formData,
                success: function(response) {
                    alert('Компания успешно добавлена');
                    modal.style.display = 'none';
                    location.reload();
                },
                error: function(response) {
                    alert('Ошибка при добавлении компании');
                }
            });
        });
    });
</script>
{% endblock %}
